<!DOCTYPE html>
<html lang="tr">
<head>
    <title>PRO LISTE V5 - DYNAMIC WHITE</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root { --bg: #ffffff; --card: #f8fafc; --accent: #3b82f6; --success: #ffffff; --danger: #ef4444; --text: #1e293b; --shadow: 0 2px 4px rgba(0,0,0,0.1); }
        body { margin: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f1f5f9; color: var(--text); display: flex; flex-direction: column; height: 100vh; overflow: hidden; user-select: none; touch-action: pan-x pan-y; }
        .blur-target { transition: filter 0.3s ease; display: flex; flex-direction: column; height: 100vh; }
        body.modal-open .blur-target { filter: blur(8px); pointer-events: none; }
        
        .top-fixed-bar { background: var(--bg); padding: 15px; border-bottom: 2px solid #e2e8f0; z-index: 100; box-shadow: var(--shadow); }
        .header-row { display: flex; justify-content: space-between; align-items: center; }
        .menu-icon { font-size: 30px; cursor: pointer; color: var(--text); padding: 5px; }
        .header-title { font-size: 20px; font-weight: 900; color: var(--text); text-transform: uppercase; letter-spacing: 1px; }
        .action-btns { display: flex; gap: 8px; }
        
        .circle-btn { width: 45px; height: 45px; border-radius: 12px; border: none; font-size: 24px; font-weight: bold; color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-plus { background: #22c55e; }
        .btn-minus { background: #64748b; }
        .btn-bulk { background: var(--accent); font-size: 18px; }

        .container { flex-grow: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; align-items: center; }
        .item-card { background: var(--bg); border-radius: 12px; width: 95%; max-width: 500px; min-height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; box-sizing: border-box; border: 1px solid #e2e8f0; box-shadow: var(--shadow); }
        .item-card.has-price { background: var(--danger); border-color: var(--danger); }
        .item-card.has-price .item-text, .item-card.has-price .item-price-tag { color: white; }
        .item-text { font-size: 18px; font-weight: 800; text-transform: uppercase; color: var(--text); flex: 1; text-align: left; }
        .item-price-tag { font-size: 16px; font-weight: 900; color: var(--accent); margin-left: 10px; }
        
        .item-card.selected { border: 4px solid var(--danger); position: relative; }
        .item-card.selected::after { content: '‚úï'; position: absolute; right: 10px; color: var(--danger); font-size: 30px; font-weight: 900; }

        .bottom-banner { background: var(--bg); border-top: 3px solid var(--accent); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -4px 10px rgba(0,0,0,0.05); }
        .total-box { cursor: pointer; }
        #total-value-display { font-size: 28px; font-weight: 900; color: var(--text); }
        .stats-mini { font-size: 14px; font-weight: 800; color: #64748b; text-align: right; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: white; width: 90%; max-width: 400px; padding: 25px; border-radius: 20px; box-sizing: border-box; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); }
        .modal-content h3 { margin: 0 0 20px 0; color: var(--text); font-size: 22px; text-align: center; font-weight: 900; }
        input, textarea { width: 100%; padding: 15px; margin: 10px 0; background: #f8fafc; border: 2px solid #e2e8f0; color: var(--text); border-radius: 12px; box-sizing: border-box; font-size: 18px; font-weight: bold; }
        input:focus { border-color: var(--accent); outline: none; }
        .modal-btns { display: flex; gap: 10px; margin-top: 20px; }
        .modal-btns button { flex: 1; padding: 15px; border-radius: 12px; border: none; font-weight: 900; font-size: 16px; cursor: pointer; }
        .btn-ok { background: var(--accent); color: white; }
        .btn-cancel { background: #e2e8f0; color: #64748b; }
        .btn-danger-action { background: var(--danger); color: white; }

        .floating-confirm { position: fixed; bottom: 100px; left: 0; width: 100%; display: none; justify-content: center; gap: 20px; z-index: 1500; }
        #loading-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; display:flex; justify-content:center; align-items:center; color:var(--accent); font-size: 24px; font-weight:900; }
    </style>
</head>
<body>

<div id="loading-screen">Y√úKLENƒ∞YOR...</div>

<div class="blur-target" id="mainWrapper">
    <div class="top-fixed-bar">
        <div class="header-row">
            <div class="menu-icon" id="clearListBtn">üóëÔ∏è</div>
            <div class="header-title">MARKET Lƒ∞STEM</div>
            <div class="action-btns">
                <button class="circle-btn btn-bulk" id="mBulkList">+++</button>
                <button class="circle-btn btn-plus" id="addQuick">+</button>
                <button class="circle-btn btn-minus" id="delQuick">-</button>
            </div>
        </div>
    </div>

    <div class="container" id="mainGrid"></div>

    <div class="bottom-banner">
        <div class="total-box" id="openBudget">
            <div style="font-size: 12px; font-weight: 800; color: #64748b;">TOPLAM TUTAR</div>
            <div id="total-value-display">0.00 TL</div>
        </div>
        <div class="stats-mini">
            <div style="font-size: 11px;">√úR√úN SAYISI</div>
            <div style="font-size: 18px; color: var(--text);">TOPLAM: <span id="total-items-count">0</span></div>
        </div>
    </div>
</div>

<div class="floating-confirm" id="deleteControls">
    <button class="circle-btn" id="confirmDel" style="background:#22c55e; width:70px; height:70px;">‚úì</button>
    <button class="circle-btn" id="cancelDel" style="background:var(--danger); width:70px; height:70px;">‚úï</button>
</div>

<div id="gModal" class="modal">
    <div class="modal-content" id="mContent"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA9whlWMrlyF6GMnWBK7SQA76qNFpO7RkQ",
        authDomain: "market-listesi-d9338.firebaseapp.com",
        projectId: "market-listesi-d9338",
        storageBucket: "market-listesi-d9338.firebasestorage.app",
        messagingSenderId: "91497340883",
        appId: "1:91497340883:web:6e9280b4a70d0a6f38d926",
        databaseURL: "https://market-listesi-d9338-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentList = [];
    let isReady = false;
    let pressTimer;
    let isLongPress = false;
    let deleteMode = false;
    let selectedForDelete = new Set();
    let userBudget = 0;

    const $ = id => document.getElementById(id);

    db.ref('v5_app_state/current').on('value', snap => {
        const cloud = snap.val();
        if(cloud) {
            currentList = cloud.data || [];
            userBudget = cloud.budget || 0;
        }
        isReady = true;
        $('loading-screen').style.display = 'none';
        render();
    });

    function sync() {
        if(!isReady) return;
        db.ref('v5_app_state/current').set({id: Date.now(), name: "Lƒ∞STE", data: currentList, budget: userBudget});
    }

    function render() {
        const grid = $('mainGrid'); grid.innerHTML = '';
        let total = 0;
        
        currentList.forEach((item, i) => {
            const card = document.createElement('div');
            card.className = `item-card ${item.price > 0 ? 'has-price' : ''}`;
            card.innerHTML = `
                <div class="item-text">${item.name}</div>
                <div class="item-price-tag">${item.price > 0 ? item.price + ' TL' : ''}</div>
            `;
            
            card.onmousedown = card.ontouchstart = () => {
                isLongPress = false;
                pressTimer = setTimeout(() => { isLongPress = true; if(navigator.vibrate) navigator.vibrate(50); openEditModal(i); }, 600);
            };
            card.onmouseup = card.ontouchend = () => clearTimeout(pressTimer);
            
            card.onclick = () => { 
                if(isLongPress) return; 
                if(deleteMode) { 
                    if(selectedForDelete.has(i)) { selectedForDelete.delete(i); card.classList.remove('selected'); } 
                    else { selectedForDelete.add(i); card.classList.add('selected'); } 
                } else { 
                    openEditModal(i); 
                } 
            };
            grid.appendChild(card);
            if(item.price > 0) { total += parseFloat(item.price); }
        });

        $('total-value-display').innerText = total.toFixed(2) + ' TL';
        $('total-items-count').innerText = currentList.length;
        
        // Modal a√ßƒ±ksa ve b√ºt√ße ekranƒ±ysa canlƒ± g√ºncelle
        const budgetRes = $('resultCalc');
        if(budgetRes) {
            const kalan = userBudget - total;
            budgetRes.innerText = `KALAN: ${kalan.toFixed(2)} TL`;
            budgetRes.style.color = kalan < 0 ? 'var(--danger)' : '#22c55e';
        }
    }

    $('clearListBtn').onclick = () => {
        document.body.classList.add('modal-open');
        $('mContent').innerHTML = `<h3>Lƒ∞STEYƒ∞ TEMƒ∞ZLE?</h3><p style="text-align:center; font-weight:bold;">T√úM √úR√úNLER Sƒ∞Lƒ∞NECEK.</p><div class="modal-btns"><button class="btn-danger-action" id="confirmClear">EVET, Sƒ∞L</button><button class="btn-cancel" id="cancelClear">ƒ∞PTAL</button></div>`;
        $('gModal').style.display = 'flex';
        $('confirmClear').onclick = () => { currentList = []; sync(); closeGModal(); };
        $('cancelClear').onclick = closeGModal;
    };

    function openAddModal() {
        document.body.classList.add('modal-open');
        $('mContent').innerHTML = `<h3>YENƒ∞ √úR√úN</h3><input type="text" id="inName" placeholder="√úR√úN ADI..." autofocus><div class="modal-btns"><button class="btn-ok" id="btnSaveAdd">EKLE</button><button class="btn-cancel" id="btnCloseM">ƒ∞PTAL</button></div>`;
        $('gModal').style.display = 'flex';
        $('btnSaveAdd').onclick = () => { const n = $('inName').value.trim().toUpperCase(); if(n) { currentList.push({name: n, price: 0}); sync(); } closeGModal(); };
        $('btnCloseM').onclick = closeGModal;
    }

    function openEditModal(i) {
        document.body.classList.add('modal-open');
        const item = currentList[i];
        $('mContent').innerHTML = `<h3>D√úZENLE</h3><input type="text" id="edName" value="${item.name}"><input type="number" id="edPrice" placeholder="Fƒ∞YAT Gƒ∞R (TL)" value="${item.price || ''}"><div class="modal-btns"><button class="btn-ok" id="btnSaveEdit">KAYDET</button><button class="btn-cancel" id="btnCloseE">ƒ∞PTAL</button></div>`;
        $('gModal').style.display = 'flex';
        $('btnSaveEdit').onclick = () => { currentList[i].name = $('edName').value.trim().toUpperCase(); currentList[i].price = $('edPrice').value || 0; sync(); closeGModal(); };
        $('btnCloseE').onclick = closeGModal;
    }

    $('openBudget').onclick = () => {
        const currentTotal = parseFloat($('total-value-display').innerText);
        document.body.classList.add('modal-open');
        $('mContent').innerHTML = `<h3>BAKƒ∞YE HESABI</h3><input type="number" id="budgetInput" placeholder="CEBƒ∞NDEKƒ∞ PARA" value="${userBudget || ''}"><div id="resultCalc" style="text-align:center; font-weight:900; font-size:22px; margin:15px 0;"></div><div class="modal-btns"><button class="btn-ok" id="btnSaveBudget">B√úT√áEYƒ∞ KAYDET</button><button class="btn-cancel" id="btnCloseCalc">KAPAT</button></div>`;
        $('gModal').style.display = 'flex';
        
        const updateCalc = () => {
            const tempBudget = parseFloat($('budgetInput').value) || 0;
            const kalan = tempBudget - currentTotal;
            $('resultCalc').innerText = `KALAN: ${kalan.toFixed(2)} TL`;
            $('resultCalc').style.color = kalan < 0 ? 'var(--danger)' : '#22c55e';
        };

        $('budgetInput').oninput = updateCalc;
        updateCalc();

        $('btnSaveBudget').onclick = () => {
            userBudget = parseFloat($('budgetInput').value) || 0;
            sync();
            closeGModal();
        };
        $('btnCloseCalc').onclick = closeGModal;
    };

    $('mBulkList').onclick = () => {
        document.body.classList.add('modal-open');
        const currentNames = currentList.map(x => x.name).join('\n');
        $('mContent').innerHTML = `<h3>TOPLU Lƒ∞STE</h3><textarea id="bulkData" rows="10" placeholder="HER SATIRA Bƒ∞R √úR√úN...">${currentNames}</textarea><div class="modal-btns"><button class="btn-ok" id="btnSaveBulk">G√úNCELLE</button><button class="btn-cancel" id="btnCloseB">ƒ∞PTAL</button></div>`;
        $('gModal').style.display = 'flex';
        $('btnSaveBulk').onclick = () => {
            const lines = $('bulkData').value.split('\n'); let newList = [];
            lines.forEach(line => { const n = line.trim().toUpperCase(); if(n) { const ex = currentList.find(x => x.name === n); newList.push(ex ? ex : {name: n, price: 0}); } });
            currentList = newList; sync(); closeGModal();
        };
        $('btnCloseB').onclick = closeGModal;
    };

    $('delQuick').onclick = () => { deleteMode = true; selectedForDelete.clear(); $('deleteControls').style.display = 'flex'; $('mainWrapper').style.opacity = "0.5"; };
    $('cancelDel').onclick = () => { deleteMode = false; $('deleteControls').style.display = 'none'; $('mainWrapper').style.opacity = "1"; render(); };
    $('confirmDel').onclick = () => { currentList = currentList.filter((_, i) => !selectedForDelete.has(i)); deleteMode = false; $('deleteControls').style.display = 'none'; $('mainWrapper').style.opacity = "1"; sync(); };
    
    function closeGModal() { $('gModal').style.display='none'; document.body.classList.remove('modal-open'); }
    $('addQuick').onclick = openAddModal;
</script>
</body>
</html>
