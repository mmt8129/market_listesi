<!DOCTYPE html>
<html lang="tr">
<head>
    <title>PRO LISTE - FIREBASE ULTIMATE</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root { --bg:#121212; --card:#1e1e1e; --text:#fff; --accent:#BB86FC; --danger:#CF6679; --success:#03DAC6; }
        body { margin:0; font-family:sans-serif; background:var(--bg); color:var(--text); height:100vh; display:flex; flex-direction:column; overflow:hidden; }
        
        .status-bar { padding:5px; text-align:center; font-size:12px; font-weight:bold; letter-spacing:1px; }
        .status-on { background:var(--success); color:#000; }
        .status-off { background:var(--danger); color:#fff; }

        .top-bar { background:var(--card); padding:15px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; }
        #total { font-size:24px; font-weight:900; color:var(--accent); }
        
        .grid { flex:1; overflow-y:auto; padding:10px; display:grid; grid-template-columns:repeat(3, 1fr); gap:8px; align-content:start; }
        .item { background:#2c2c2c; border-radius:8px; padding:15px 5px; text-align:center; position:relative; border:1px solid #333; display:flex; flex-direction:column; justify-content:center; min-height:60px; }
        .item.priced { border-color:var(--success); background:#1a3b34; }
        .name { font-weight:bold; font-size:14px; word-break:break-word; text-transform:uppercase; }
        .price { color:var(--success); font-weight:bold; font-size:12px; margin-top:4px; }

        .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); display:none; justify-content:center; align-items:center; z-index:999; }
        .box { background:var(--card); width:85%; padding:20px; border-radius:10px; border:1px solid var(--accent); }
        input { width:100%; padding:15px; margin:10px 0; background:#000; border:1px solid #444; color:#fff; border-radius:5px; box-sizing:border-box; font-size:16px; text-transform:uppercase; }
        button { width:100%; padding:15px; border:none; border-radius:5px; font-weight:bold; font-size:16px; cursor:pointer; margin-top:5px; }
        .btn-add { background:var(--accent); color:#000; }
        .btn-del { background:var(--danger); color:#fff; margin-top:10px; }
        .btn-close { background:transparent; color:#888; margin-top:10px; font-size:12px; }
        .fab { position:fixed; bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; background:var(--accent); color:#000; font-size:30px; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; }
    </style>
</head>
<body>

<div id="status" class="status-bar status-off">BAÄžLANTI BEKLENÄ°YOR...</div>

<div class="top-bar">
    <div style="font-weight:bold; font-size:18px;">MARKET V5</div>
    <div id="total">0.00 TL</div>
</div>

<div class="grid" id="grid"></div>

<button class="fab" onclick="openAdd()">+</button>

<div id="modal" class="modal">
    <div class="box" id="modalContent"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// ðŸ”¥ SENÄ°N CONFIG BÄ°LGÄ°LERÄ°N
const firebaseConfig = {
    apiKey: "AIzaSyA9whlWMrlyF6GMnWBK7SQA76qNFpO7RkQ",
    authDomain: "market-listesi-d9338.firebaseapp.com",
    projectId: "market-listesi-d9338",
    storageBucket: "market-listesi-d9338.firebasestorage.app",
    messagingSenderId: "91497340883",
    appId: "1:91497340883:web:6e9280b4a70d0a6f38d926",
    databaseURL: "https://market-listesi-d9338-default-rtdb.firebaseio.com"
};

// BaÅŸlat
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let list = [];

// ðŸ”¹ BAÄžLANTI KONTROLÃœ
const connectedRef = db.ref(".info/connected");
connectedRef.on("value", (snap) => {
    const el = document.getElementById('status');
    if (snap.val() === true) {
        el.innerText = "BAÄžLANDI (ONLINE)";
        el.className = "status-bar status-on";
    } else {
        el.innerText = "BAÄžLANTI KOPTU (OFFLINE)";
        el.className = "status-bar status-off";
    }
});

// ðŸ”¹ VERÄ°YÄ° DÄ°NLE (TEK YÃ–NLÃœ AKIÅž)
db.ref('items').on('value', (snapshot) => {
    const data = snapshot.val();
    list = data ? Object.values(data) : []; // Object to Array
    render();
});

// ðŸ”¹ VERÄ°YÄ° YAZ (HER DEÄžÄ°ÅžÄ°KLÄ°KTE)
function sync() {
    db.ref('items').set(list);
}

function render() {
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    let total = 0;

    list.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = `item ${item.price > 0 ? 'priced' : ''}`;
        div.onclick = () => openEdit(index);
        div.innerHTML = `
            <div class="name">${item.name}</div>
            ${item.price > 0 ? `<div class="price">${item.price} TL</div>` : ''}
        `;
        grid.appendChild(div);
        if(item.price) total += parseFloat(item.price);
    });
    
    document.getElementById('total').innerText = total.toFixed(2) + " TL";
}

function openAdd() {
    const box = document.getElementById('modalContent');
    box.innerHTML = `
        <h3>ÃœRÃœN EKLE</h3>
        <input id="inpName" placeholder="Ne alÄ±nacak?" autofocus>
        <button class="btn-add" onclick="addItem()">EKLE</button>
        <button class="btn-close" onclick="closeM()">VAZGEÃ‡</button>
    `;
    document.getElementById('modal').style.display = 'flex';
    setTimeout(() => document.getElementById('inpName').focus(), 100);
}

function addItem() {
    const val = document.getElementById('inpName').value.trim().toUpperCase();
    if(val) {
        list.push({ name: val, price: 0 });
        sync();
        closeM();
    }
}

function openEdit(index) {
    const item = list[index];
    const box = document.getElementById('modalContent');
    box.innerHTML = `
        <h3>${item.name}</h3>
        <input id="inpPrice" type="number" placeholder="Fiyat gir..." value="${item.price || ''}">
        <button class="btn-add" onclick="saveItem(${index})">KAYDET</button>
        <button class="btn-del" onclick="delItem(${index})">SÄ°L</button>
        <button class="btn-close" onclick="closeM()">KAPAT</button>
    `;
    document.getElementById('modal').style.display = 'flex';
    setTimeout(() => document.getElementById('inpPrice').focus(), 100);
}

function saveItem(index) {
    const p = document.getElementById('inpPrice').value;
    list[index].price = p ? parseFloat(p) : 0;
    sync();
    closeM();
}

function delItem(index) {
    list.splice(index, 1);
    sync();
    closeM();
}

function closeM() {
    document.getElementById('modal').style.display = 'none';
}

window.onclick = (e) => {
    if (e.target == document.getElementById('modal')) closeM();
}
</script>
</body>
</html>
